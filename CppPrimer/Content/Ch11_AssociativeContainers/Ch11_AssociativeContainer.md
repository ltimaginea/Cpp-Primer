# ***Associative Container***

## 概述

类似顺序容器，关联容器也是类模板。但关联容器和顺序容器有着根本的不同：关联容器中的元素是按关键字来保存和访问的。与之相对，顺序容器中的元素是按它们在容器中的位置来顺序保存和访问的。

关联容器支持高效的关键字查找和访问。两个主要的关联容器（associative-container）类型是map和set。map中的元素是一些关键字-值（key-value）对：关键字起到索引的作用，值则表示与索引相关联的数据。set中每个元素只包含一个关键字。

标准库定义了8个关联容器，它们的不同体现在三个维度上：

- 是一个map或是一个set。map保存关键字-值对；set只保存关键字。
- 要求关键字唯一或不要求。
- 保持关键字有序或不保证有序。

有序容器使用比较函数来比较关键字，从而将元素按顺序存储。默认情况下，比较操作是采用关键字类型的<运算符。

无序容器使用关键字类型的==运算符和一个hash<key_type>类型的对象来组织元素。无序容器用哈希技术(hash)而不是比较操作来管理元素的位置、存储和访问元素。

关联容器的迭代器都是双向的。

无论在有序容器中还是在无序容器中，具有相同关键字的元素都是相邻存储的。

![](https://github.com/ltimaginea/Cpp-Primer/blob/main/CppPrimer/Images/Chapter11/Ch11_01_AssociativeContainerType.jpg)

## map

当定义一个map时，必须既指明关键字类型又指明值类型。我们将每个关键字-值对包围在花括号中： **`{key, value}`** 来指出它们一起构成了map中的一个元素。在每个花括号中，关键字是第一个元素，值是第二个。

一个map中的关键字必须是唯一的，即，对于一个给定的关键字，只能有一个元素的关键字等于它。容器multimap没有此限制，它允许多个元素具有相同的关键字。

在一个map中，元素是关键字-值对。即，每个元素是一个pair对象，包含一个关键字和一个关联的值。只有map类型（unordered_map、unordered_multimap、multimap和map）才定义了mapped_type。

当解引用一个关联容器迭代器时，我们会得到一个类型为容器的value_type的值的引用。对map而言，value_type是一个pair类型，其first成员保存**const的关键字**，second成员保存值。

## set

定义一个set时，只需指明关键字类型，因为set中没有值。

一个set中的关键字必须是唯一的，即，对于一个给定的关键字，只能有一个元素的关键字等于它。容器multiset没有此限制，它允许多个元素具有相同的关键字。

对于set类型，key_type和value_type是一样的；set中保存的值就是关键字。

虽然set类型同时定义了iterator和const_iterator类型，但两种类型都只允许只读访问set中的元素。与不能改变一个map元素的关键字一样，**一个set中的关键字也是const的**。可以用一个set迭代器来读取元素的值，但不能修改。

## 关键字类型要求

关联容器对其关键字类型有一些限制。

对于有序容器——map、multimap、set以及multiset，关键字类型必须定义元素比较的方法。默认情况下，标准库使用关键字类型的<运算符来比较两个关键字。在集合类型中，关键字类型就是元素类型；在映射类型中，关键字类型是元素的第一部分的类型。

新标准定义了4个无序关联容器（unordered associative container）。这些容器不是使用比较运算符来组织元素，而是使用一个哈希函数（hash function）和关键字类型的==运算符。

### 有序容器的关键字类型

我们可以自定义比较操作，其可以是函数对象类，也可以是函数指针类型，或对"<"运算符经过适当重载。当自定义的比较函数是成员函数时，需要把比较函数定义为const成员函数。当比较操作是函数指针类型时，必须用具体的函数指针来初始化对象。

### 无序容器的关键字类型

实参分别是桶大小、哈希函数指针和相等性判断运算符指针。我们可以自定义比较操作，其可以是函数对象类，也可以是函数指针类型，或对"=="运算符经过适当重载。当自定义的比较函数是成员函数时，需要把比较函数定义为const成员函数。当比较操作是函数指针类型时，必须用具体的函数指针来初始化对象。

默认情况下，无序容器使用关键字类型的==运算符来比较元素，它们还使用一个hash<key_type>类型的对象来生成每个元素的哈希值。

我们可以直接定义关键字是内置类型（包括指针类型）、string还是智能指针类型的无序容器。 但是，我们不能直接定义关键字类型为自定义类类型的无序容器。与容器不同，不能直接使用哈希模板，而必须提供我们自己的hash模板版本。

对于定义关键字类型为自定义类类型的无序容器，我们需要提供函数来替代==运算符和哈希值计算函数。

无序容器在存储上组织为一组桶，每个桶保存零个或多个元素。无序容器使用一个哈希函数将元素映射到桶。如果容器允许重复关键字，所有具有相同关键字的元素也都会在同一个桶中。